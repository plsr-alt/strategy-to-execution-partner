# Skill: agent-memory

## 目的

ユーザーの指示・好み・文脈情報を適切なファイルに永続保存し、以降のセッションで自律的に参照できるようにする。

## トリガー

- 「覚えておいて」

## 入力

ユーザーが記憶させたい任意の情報。例:
- 「報告書は結論から書いて。覚えておいて」
- 「田中さんはレスが遅め。覚えておいて」
- 「プロジェクトXの予算上限は300万。覚えておいて」

## 記憶分類と保存先

| 分類 | 判定基準 | 保存先 |
|------|---------|--------|
| 恒久ルール・好み | 個人の価値観・文体・作業スタイルなど時間経過で変わらないもの | `01_MANUAL/prefs_and_principles.md` |
| プロジェクト記憶 | 特定プロジェクトに紐づく事実・決定・制約 | `03_PROJECTS/<project>/memory.md` |
| 人物・関係性 | 取引先・チームメンバー・顧客の特徴や注意点 | `08_PEOPLE/people_notes.md` |
| 運用メモ | 上記に該当しない業務上のTips・手順・一時的な取り決め | `06_OPERATIONS/ops_notes.md` |

**判定の優先順位**: 恒久 → プロジェクト → 人物 → 運用（迷ったら運用に仮置きし、週次レビューで再分類）

## 参照ファイル/データ

保存先の既存ファイル（重複チェック用）

## 手順

### Step 1: 分類判定
- ユーザーの発言内容から上記4分類のどれに該当するか判定
- 複数分類にまたがる場合は主たる分類1つに保存し、関連先にクロスリファレンスを記載

### Step 2: 正規化
- 口語を簡潔な事実文に変換する
- 1記憶＝1行の箇条書きを原則とする
- 日付を付与: `- [YYYY-MM-DD] 内容`

### Step 3: 重複チェック
- 保存先ファイルを読み込み、同一・類似の記憶がないか確認
- **同一**: 日付のみ更新、内容はそのまま
- **類似（矛盾）**: 古い記憶を新しい内容で上書き。変更履歴を `(旧: ...)` で1行付記
- **類似（補完）**: 既存の記憶に情報を統合して1行にまとめる

### Step 4: 書き込み
- 該当ファイルの適切なセクションに追記
- ファイルが存在しない場合は新規作成

### Step 5: 確認応答
- 保存した内容・保存先をユーザーに1行で報告

## 出力

ユーザーへの応答（例）:

```
覚えました: 「報告書は結論→理由→アクションの順で書く」→ 01_MANUAL/prefs_and_principles.md に保存
```

## 保存先ファイルのフォーマット

### 01_MANUAL/prefs_and_principles.md
```markdown
# Preferences & Principles

## コミュニケーション
- [2026-02-20] 報告書は結論→理由→アクションの順で書く
- [2026-02-20] メールは3行以内、敬語は最小限

## 作業スタイル
- [2026-02-20] 午前中は深い作業に集中。会議は午後に寄せる

## 意思決定
-
```

### 03_PROJECTS/\<project\>/memory.md
```markdown
# Project Memory: {プロジェクト名}

- [2026-02-20] 予算上限300万（税別）
- [2026-02-20] デザインはA社に外注、窓口は佐藤さん
```

### 08_PEOPLE/people_notes.md
```markdown
# People Notes

## 田中太郎（株式会社X / 営業部長）
- [2026-02-20] レス遅め。急ぎは電話が確実
- [2026-02-20] ゴルフ好き。雑談ネタに使える

## 佐藤花子（デザイン会社A / ディレクター）
-
```

### 06_OPERATIONS/ops_notes.md
```markdown
# Operations Notes

- [2026-02-20] 月末の経費精算は25日までに提出
- [2026-02-20] Slack通知は18時以降オフにする
```

## 正規化ルールまとめ

| ルール | 例 |
|--------|---|
| 口語→事実文 | 「あの人メール遅いんだよね」→「レス遅め。急ぎは電話が確実」 |
| 1記憶1行 | 複合文は分割して箇条書き |
| 日付必須 | `[YYYY-MM-DD]` を先頭に付与 |
| 重複は統合 | 古い情報は上書き、矛盾時は旧情報を `(旧: ...)` で付記 |
| 曖昧→具体 | 「多め」→ 可能なら数値化。不明なら原文を保持 |
