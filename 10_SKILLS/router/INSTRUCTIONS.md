# Skill: router — 詳細手順

## 目的

ユーザーの入力を解析し、**Main**（経営管理モード）と **Runbook**（手順実行モード）のどちらで動くべきかを判定する。判定後、参照すべきルールファイルと次に起動するスキルを宣言する。

**すべての応答の冒頭に `[MODE: Main]` または `[MODE: Runbook]` を付与する。**

## トリガー

全入力（router は常に最初に動く暗黙スキル）

## モード定義

| モード | 用途 | 典型的な作業 |
|--------|------|-------------|
| **Main** | 経営管理・日常業務 | スケジュール作成、タスク管理、KPI確認、コンテンツ制作、記憶保存、戦略検討 |
| **Runbook** | 手順書に沿った技術実行 | PoC構築、自動化スクリプト、OCR/キャプチャ処理、環境構築、デモ準備の技術作業 |

## 判定ロジック

### Step 1: 明示指定の確認
ユーザーが明示的にモードを指定している場合はそれに従う:
- `MODE:Main` `メインモード` → Main
- `MODE:Runbook` `ランブックモード` → Runbook

### Step 2: キーワード判定
明示指定がない場合、入力のキーワードで判定する:

**→ Runbook に振る語**
- 手順書 / runbook / 自動化 / スクリプト
- PoC / プロトタイプ / 検証環境
- キャプチャ / OCR / スクレイピング
- 入力自動化 / RPA / バッチ
- デプロイ / ビルド / インストール / セットアップ
- API連携 / webhook / cron

**→ Main に振る語**
- おはよう / 予定 / スケジュール / タスク
- 覚えておいて / 記事にして / 投稿
- KPI / 売上 / 振り返り / 戦略
- Issue / プロジェクト / 採用 / 人材

### Step 3: 文脈判定
キーワードで判定できない場合:
- `03_PROJECTS/` 配下にプロジェクト固有の `CLAUDE.md` や `runbook.md` が存在する案件の話題 → Runbook
- それ以外 → Main（デフォルト）

## 参照ルールファイルの決定

| モード | 参照するルールファイル |
|--------|---------------------|
| Main | `/CLAUDE.md`（ルート） |
| Runbook | `/03_PROJECTS/<project>/CLAUDE.md` があればそれ、なければ `/CLAUDE.md`（ルート） |

**Runbook時の探索順:**
1. `03_PROJECTS/<該当PJ>/CLAUDE.md` — PJ固有ルール
2. `03_PROJECTS/<該当PJ>/runbook.md` — 手順書
3. `/CLAUDE.md` — フォールバック（ルート）

## 次スキルの決定

### Main モード
| 入力パターン | 起動スキル |
|-------------|-----------|
| おはよう / 今日の予定 | daily-schedule |
| 覚えておいて | agent-memory |
| 記事にして / 投稿作って | content-pipeline |
| Issueにして / タスク登録 | issue-triage |
| KPI / 数値 / 振り返り | （直接対応・スキル不要） |
| 上記に該当しない | （直接対応・スキル不要） |

### Runbook モード
| 入力パターン | 起動スキル/アクション |
|-------------|---------------------|
| 手順書あり（runbook.md存在） | runbook.md を読み込み、Step順に実行 |
| 手順書なし + 技術タスク | 調査 → 手順書を `03_PROJECTS/<PJ>/runbook.md` に生成 → 実行 |
| PoC / 検証 | 調査 → 技術検証 → 結果を `04_RESEARCH/` に保存 |

## 出力

応答の冒頭に以下を宣言する:

```
[MODE: Main]
参照: /CLAUDE.md
スキル: daily-schedule
```

または

```
[MODE: Runbook]
参照: /03_PROJECTS/ocr-automation/CLAUDE.md
手順書: /03_PROJECTS/ocr-automation/runbook.md
```

宣言後、該当スキルの手順に入る。宣言は1行目に置き、本文と空行で区切る。

## 判定例

| ユーザー入力 | 判定 | 理由 |
|-------------|------|------|
| 「おはよう」 | Main → daily-schedule | 挨拶トリガー |
| 「OCRでPDFを読み取る仕組みを作って」 | Runbook | OCR + 自動化キーワード |
| 「A社の提案書を記事にして」 | Main → content-pipeline | 記事化トリガー |
| 「デモ環境をセットアップして」 | Runbook | セットアップキーワード |
| 「来月のKPI目標を考えたい」 | Main（直接対応） | KPIキーワード |
| 「手順書作って：毎月の請求書PDF取込」 | Runbook | 手順書 + 自動化 |
| 「覚えておいて：A社の予算は500万」 | Main → agent-memory | 記憶トリガー |
| 「MODE:Runbook API連携の検証をしたい」 | Runbook | 明示指定 |
