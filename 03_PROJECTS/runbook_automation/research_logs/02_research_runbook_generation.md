# 方式調査・整理

## 1. UI自動操作方式
- **調査観点**: ブラウザ操作の安定性と要素取得のしやすさ。
- **要点まとめ**: OSSツールが主流。CDP (Chrome DevTools Protocol) を叩けるものが現代的。
- **技術選択肢**: Playwright, Puppeteer, Selenium, Cypress。
- **判断材料**: 複数タブ対応、フレーム対応、実行速度、DOM snapshotの取りやすさ。
- **仮定**: 最新ブラウザの操作が主であり、レガシープラグイン(Flash等)は対象外。
- **未解決論点**: ローカルPCの既存ブラウザプロファイル（Cookie等）を再利用する際のセキュリティ担保。

## 2. AI UI認識方式（3方式）
- **調査観点**: UI変更耐性と誤操作リスクのトレードオフ。
- **要点まとめ**: 
  - 方式1: A11y / DOM優先 + AI補正（Self-healing selectors）。既存ツール(Playwright等)のLocatorが外れた時のみDOMツリーをAIに解釈させる。
  - 方式2: Vision（スクショ）× DOMハイブリッド。視覚情報によるバウンディングボックスとDOM座標を突き合わせる。
  - 方式3: Visionのみ（画像理解ベース）。VLA (Vision-Language-Action) モデルなどで画面スクショから「ここをクリック」を座標で出力。
- **技術選択肢**: Playwright + LLM(DOM parse), GPT-4o / Claude 3.5 Sonnet(Vision), OS-Copilot系エージェント。
- **判断材料**: 方式3は柔軟だが座標の「ズレ」による誤操作リスクが極めて高い。方式1は確実性が高いが大幅なUI変更には弱い。本プロジェクトの「安全第一」では方式1ベース、または方式2を検討。
- **仮定**: Vision AIのレスポンスには数秒かかるため、全ステップVisionは遅すぎる。
- **未解決論点**: DOMが肥大化・難読化されている巨大SPA（まさにAWSコンソール等）でのDOM切り出しの最適解。

## 3. キャプチャ設計（粒度・証跡）
- **調査観点**: 手順書として必要な粒度と、監査として必要な粒度。
- **要点まとめ**: 操作前後、状態変化の瞬間に必ず撮る。
- **技術選択肢**: フルスクリーンキャプチャ vs 特定DOMのviewportキャプチャ。
- **判断材料**: 監査・手順書には「画面全体（文脈）」が必要だが、サイズが大きくなる。手順書用には操作対象をクロップ（切り抜き）またはハイライトする枠を合成する。
- **仮定**: 証跡用には無加工フルスクリーン、手順書用にはハイライト加工画像を使用。
- **未解決論点**: スクリーンショットの長期間保存に伴うストレージ容量の推移。

## 4. 手順書生成方式
- **調査観点**: ログと画像の統合によるMarkdown生成の自動化。
- **要点まとめ**: アクションログと画像をセットにしてLLMに渡し、解説文を生成する。
- **技術選択肢**: ローカルスクリプトによる文字列結合、マルチモーダルLLMによる一括生成。
- **判断材料**: マルチモーダルLLMなら「画面を見て」より正確な状況説明を書けるが、トークンコストがかさむ。
- **仮定**: 1操作ごとにStepごとの説明をLLM生成し、後で結合するチャンク処理とする。
- **未解決論点**: 巨大な手順の場合のコンテキスト長あふれ。

## 5. 認証の扱い
- **調査観点**: AWS等へのログイン、MFAの突破方法。
- **要点まとめ**: AIに認証をやらせるのはリスクと難易度が高い。
- **技術選択肢**: 手動ログイン後のセッション再利用（Cookie/Local Storageの注入）、人手介入による一時停止（Wait for user input）。
- **判断材料**: 「安全に自動」の原則から、認証プロセス自体は手動、またはSSOトークンをスクリプト起動時に渡す形式が安全。
- **仮定**: MFAはツール外でクリア済みとする。
- **未解決論点**: セッション有効期限切れへの再試行ハンドリング。

## 6. 非機能要件対応
- **調査観点**: 特にPIIマスキングと誤操作防止。
- **要点まとめ**: 操作の許可リスト（Allowlist）と必須確認フラグ。マスキングはローカルでAI/OCR前に行うか要検討。
- **技術選択肢**: Local OCR+正規表現マスキング、クラウドDLP API。
- **判断材料**: ローカルでの軽量なマスキングが望ましい。誤操作防止には操作前DOM差分スコアの確認。
- **仮定**: 対象システムには明らかな機密情報画面が含まれ得る。
- **未解決論点**: 未知のUIコンポーネントにおけるマスキング漏れリスク。
